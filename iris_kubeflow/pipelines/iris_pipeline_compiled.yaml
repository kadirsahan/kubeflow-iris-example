# PIPELINE DEFINITION
# Name: iris-classification-pipeline
# Description: A pipeline that trains and predicts on the Iris dataset using Harbor registry images.
# Inputs:
#    model_hyperparameters: str [Default: '{"objective":"multi:softprob", "eval_metric":"mlogloss", "random_state":42}']
#    model_name: str [Default: 'xgboost']
#    prediction_data: str [Default: '5.1,3.5,1.4,0.2;6.7,3.0,5.2,2.3']
components:
  comp-download-iris-dataset:
    executorLabel: exec-download-iris-dataset
    outputDefinitions:
      artifacts:
        data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
  comp-predict-iris-species:
    executorLabel: exec-predict-iris-species
    inputDefinitions:
      artifacts:
        model:
          artifactType:
            schemaTitle: system.Model
            schemaVersion: 0.0.1
      parameters:
        input_data:
          parameterType: STRING
  comp-train-iris-model:
    executorLabel: exec-train-iris-model
    inputDefinitions:
      artifacts:
        data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        model_hyperparameters:
          defaultValue: '{}'
          isOptional: true
          parameterType: STRING
        model_name:
          defaultValue: xgboost
          isOptional: true
          parameterType: STRING
    outputDefinitions:
      artifacts:
        model:
          artifactType:
            schemaTitle: system.Model
            schemaVersion: 0.0.1
deploymentSpec:
  executors:
    exec-download-iris-dataset:
      container:
        command:
        - python
        - download.py
        - --output_path
        - '{{$.outputs.artifacts[''data''].path}}'
        image: 192.168.58.12:30002/kubeflow-iris/iris-download:v1.0
    exec-predict-iris-species:
      container:
        command:
        - python
        - predict.py
        - --model_path
        - '{{$.inputs.artifacts[''model''].path}}'
        - --input_data
        - '{{$.inputs.parameters[''input_data'']}}'
        image: 192.168.58.12:30002/kubeflow-iris/iris-predict:v1.0
    exec-train-iris-model:
      container:
        command:
        - python
        - train.py
        - --data_path
        - '{{$.inputs.artifacts[''data''].path}}'
        - --model_output_path
        - '{{$.outputs.artifacts[''model''].path}}'
        - --model-name
        - '{{$.inputs.parameters[''model_name'']}}'
        - --model-hyperparameters
        - '{{$.inputs.parameters[''model_hyperparameters'']}}'
        image: 192.168.58.12:30002/kubeflow-iris/iris-train:v1.0
pipelineInfo:
  description: A pipeline that trains and predicts on the Iris dataset using Harbor
    registry images.
  name: iris-classification-pipeline
root:
  dag:
    tasks:
      download-iris-dataset:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-download-iris-dataset
        taskInfo:
          name: download-iris-dataset
      predict-iris-species:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-predict-iris-species
        dependentTasks:
        - train-iris-model
        inputs:
          artifacts:
            model:
              taskOutputArtifact:
                outputArtifactKey: model
                producerTask: train-iris-model
          parameters:
            input_data:
              componentInputParameter: prediction_data
        taskInfo:
          name: predict-iris-species
      train-iris-model:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train-iris-model
        dependentTasks:
        - download-iris-dataset
        inputs:
          artifacts:
            data:
              taskOutputArtifact:
                outputArtifactKey: data
                producerTask: download-iris-dataset
          parameters:
            model_hyperparameters:
              componentInputParameter: model_hyperparameters
            model_name:
              componentInputParameter: model_name
        taskInfo:
          name: train-iris-model
  inputDefinitions:
    parameters:
      model_hyperparameters:
        defaultValue: '{"objective":"multi:softprob", "eval_metric":"mlogloss", "random_state":42}'
        isOptional: true
        parameterType: STRING
      model_name:
        defaultValue: xgboost
        isOptional: true
        parameterType: STRING
      prediction_data:
        defaultValue: 5.1,3.5,1.4,0.2;6.7,3.0,5.2,2.3
        isOptional: true
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.15.1
